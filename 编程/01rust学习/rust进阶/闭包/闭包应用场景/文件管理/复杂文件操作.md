---
创建时间: 星期三, 8月 28日 2024, 6:30 晚上
最近修改: 
---
```rust
use std::fs::{File, OpenOptions};
use std::io::{self, Read, Write, Seek, SeekFrom};

fn with_file<F, R>(filename: &str, mode: &str, operation: F) -> io::Result<R>
where
    F: FnOnce(&mut File) -> io::Result<R>,
{
    let mut file = OpenOptions::new()
        .read(mode.contains("r"))
        .write(mode.contains("w"))
        .create(mode.contains("c"))
        .append(mode.contains("a"))
        .open(filename)?;
    
    operation(&mut file)
}

fn main() -> io::Result<()> {
    // 读取并修改文件
    with_file("data.txt", "rw", |file| {
        let mut content = String::new();
        file.read_to_string(&mut content)?;
        
        let modified = content.replace("old", "new");
        
        file.seek(SeekFrom::Start(0))?;
        file.write_all(modified.as_bytes())?;
        
        Ok(())
    })?;

    // 追加到文件
    with_file("log.txt", "a", |file| {
        writeln!(file, "Log entry at {}", chrono::Local::now())
    })?;

    Ok(())
}

````
